import pgn from '../../src/chess-board/pgn';
const test = require('ava');

test('PGN module #pgnToPosition returns starting position with no moves', t => {
    t.deepEqual(pgn.pgnToPosition([]), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);
});

test('PGN module #pgnToPosition moves pawns correctly', t => {
    t.deepEqual(pgn.pgnToPosition(['e4']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', 'wP', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', '00', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);

    t.deepEqual(pgn.pgnToPosition(['d4', 'c5']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', '00', 'bP', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', 'bP', '00', '00', '00', '00', '00'],
        ['00', '00', '00', 'wP', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', '00', 'wP', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);

    t.deepEqual(pgn.pgnToPosition(['d4', 'd5', 'c4']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', 'bP', '00', '00', '00', '00'],
        ['00', '00', 'wP', 'wP', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', '00', '00', 'wP', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);
});

test('PGN module #pgnToPosition pawn takes correctly', t => {
    t.deepEqual(pgn.pgnToPosition(['d4', 'd5', 'c4', 'dxc4']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', 'bP', 'wP', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', '00', '00', 'wP', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);
    t.deepEqual(pgn.pgnToPosition(['e4', 'd5', 'exd5']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', 'wP', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', '00', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);
});

test('PGN module #pgnToPosition pawn takes correctly en passant', t => {
    t.deepEqual(pgn.pgnToPosition(['e4', 'a6', 'e5', 'd5', 'exd6']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['00', 'bP', 'bP', '00', 'bP', 'bP', 'bP', 'bP'],
        ['bP', '00', '00', 'wP', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', '00', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);

    t.deepEqual(pgn.pgnToPosition(['a3', 'e5', 'h3', 'e4', 'd4', 'exd3']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', '00', '00', 'bP', '00', '00', '00', 'wP'],
        ['00', 'wP', 'wP', '00', 'wP', 'wP', 'wP', '00'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);
});

test('PGN module #pgnToPosition moves knights correctly', t => {
    t.deepEqual(pgn.pgnToPosition(['Nf3']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', 'wN', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', '00', 'wR'],
    ]);

    t.deepEqual(pgn.pgnToPosition(['d4', 'Nf6']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', '00', 'bR'],
        ['bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', 'bN', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', 'wP', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', '00', 'wP', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);

    t.deepEqual(pgn.pgnToPosition(['e4', 'd6', 'Ne2', 'Nd7']), [
        ['bR', '00', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bN', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', 'bP', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', 'wP', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', 'wN', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', '00', 'wR'],
    ]);
});

test('PGN module #pgnToPosition knight takes correctly', t => {
    t.deepEqual(pgn.pgnToPosition(['Nf3', 'e5', 'Nxe5']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', 'wN', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', '00', 'wR'],
    ]);
    
    t.deepEqual(pgn.pgnToPosition(['e4', 'Nf6', 'd4', 'Nxe4']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', '00', 'bR'],
        ['bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', 'wP', 'bN', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', '00', '00', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);
});

test('PGN module #pgnToPosition knight moves correctly when knight column is specified', t => {
    t.deepEqual(pgn.pgnToPosition(['e4', 'c6', 'd4', 'd5', 'Nc3', 'dxe4', 'Nxe4', 'Nd7', 'Nf3', 'Ngf6']), [
        ['bR', '00', 'bB', 'bQ', 'bK', 'bB', '00', 'bR'],
        ['bP', 'bP', '00', 'bN', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', 'bP', '00', '00', 'bN', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', 'wP', 'wN', '00', '00', '00'],
        ['00', '00', '00', '00', '00', 'wN', '00', '00'],
        ['wP', 'wP', 'wP', '00', '00', 'wP', 'wP', 'wP'],
        ['wR', '00', 'wB', 'wQ', 'wK', 'wB', '00', 'wR'],
    ]);
});

test('PGN module #pgnToPosition moves bishops correctly', t => {
    t.deepEqual(pgn.pgnToPosition(['e4', 'e5', 'Bc4']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', 'bP', '00', '00', '00'],
        ['00', '00', 'wB', '00', 'wP', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', '00', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', '00', 'wN', 'wR'],
    ]);

    t.deepEqual(pgn.pgnToPosition(['d4', 'd5', 'c4', 'Bf5']), [
        ['bR', 'bN', '00', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', 'bP', '00', 'bB', '00', '00'],
        ['00', '00', 'wP', 'wP', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', '00', '00', 'wP', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);
});

test('PGN module #pgnToPosition moves kings correctly', t => {
    t.deepEqual(pgn.pgnToPosition(['e4', 'e5', 'Ke2']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', 'bP', '00', '00', '00'],
        ['00', '00', '00', '00', 'wP', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', 'wK', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', '00', 'wB', 'wN', 'wR'],
    ]);

    t.deepEqual(pgn.pgnToPosition(['e4', 'e5', 'Ke2', 'Ke7']), [
        ['bR', 'bN', 'bB', 'bQ', '00', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bP', 'bK', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', 'bP', '00', '00', '00'],
        ['00', '00', '00', '00', 'wP', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', 'wK', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', '00', 'wB', 'wN', 'wR'],
    ]);
});

test('PGN module #pgnToPosition moves queens correctly', t => {
    t.deepEqual(pgn.pgnToPosition(['e4', 'e5', 'Qf3']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', 'bP', '00', '00', '00'],
        ['00', '00', '00', '00', 'wP', '00', '00', '00'],
        ['00', '00', '00', '00', '00', 'wQ', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', '00', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', '00', 'wK', 'wB', 'wN', 'wR'],
    ]);

    t.deepEqual(pgn.pgnToPosition(['e4', 'd5', 'exd5', 'Qxd5']), [
        ['bR', 'bN', 'bB', '00', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', 'bQ', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', '00', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);
});

test('PGN module #pgnToPosition returns correct position when there are checks', t => {
    t.deepEqual(pgn.pgnToPosition(['d4', 'Nf6', 'c4', 'e6', 'Nf3', 'Bb4+']), [
        ['bR', 'bN', 'bB', 'bQ', 'bK', '00', '00', 'bR'],
        ['bP', 'bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', 'bP', 'bN', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', 'bB', 'wP', 'wP', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', 'wN', '00', '00'],
        ['wP', 'wP', '00', '00', 'wP', 'wP', 'wP', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', '00', 'wR'],
    ]);
});

test('PGN module #pgnToPosition returns correct position when there is checkmate', t => {
    t.deepEqual(pgn.pgnToPosition(['g4',  'e5',  'f3',  'Qh4']), [
        ['bR', 'bN', 'bB', '00', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', 'bP', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', 'wP', 'bQ'],
        ['00', '00', '00', '00', '00', 'wP', '00', '00'],
        ['wP', 'wP', 'wP', 'wP', 'wP', '00', '00', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
    ]);
});

test('PGN module #pgnToPosition short castles correctly', t => {
    t.deepEqual(pgn.pgnToPosition(['Nf3', 'd5', 'g3', 'c5', 'Bg2', 'Nc6', 'O-O']), [
        ['bR', '00', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
        ['bP', 'bP', '00', '00', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', 'bN', '00', '00', '00', '00', '00'],
        ['00', '00', 'bP', 'bP', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', '00', '00', '00', '00', 'wN', 'wP', '00'],
        ['wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wB', 'wP'],
        ['wR', 'wN', 'wB', 'wQ', '00', 'wR', 'wK', '00'],
    ]);

    t.deepEqual(pgn.pgnToPosition(['d4', 'Nf6', 'c4', 'e6', 'Nc3', 'Bb4', 'Qc2', 'O-O']), [
        ['bR', 'bN', 'bB', 'bQ', '00', 'bR', 'bK', '00'],
        ['bP', 'bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP'],
        ['00', '00', '00', '00', 'bP', 'bN', '00', '00'],
        ['00', '00', '00', '00', '00', '00', '00', '00'],
        ['00', 'bB', 'wP', 'wP', '00', '00', '00', '00'],
        ['00', '00', 'wN', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wQ', '00', 'wP', 'wP', 'wP', 'wP'],
        ['wR', '00', 'wB', '00', 'wK', 'wB', 'wN', 'wR'],
    ]);
});

test('PGN module #pgnToPosition long castles correctly', t => {
    t.deepEqual(pgn.pgnToPosition(['d4', 'd5', 'Bf4', 'Nc6', 'Nc3', 'Nf6', 'Qd2', 'Bf5', 'O-O-O']), [
        ['bR', '00', '00', 'bQ', 'bK', 'bB', '00', 'bR'],
        ['bP', 'bP', 'bP', '00', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', 'bN', '00', '00', 'bN', '00', '00'],
        ['00', '00', '00', 'bP', '00', 'bB', '00', '00'],
        ['00', '00', '00', 'wP', '00', 'wB', '00', '00'],
        ['00', '00', 'wN', '00', '00', '00', '00', '00'],
        ['wP', 'wP', 'wP', 'wQ', 'wP', 'wP', 'wP', 'wP'],
        ['00', '00', 'wK', 'wR', '00', 'wB', 'wN', 'wR'],
    ]);

    t.deepEqual(pgn.pgnToPosition(['d4', 'd5', 'Nf3', 'Bf5', 'e3', 'Qd7', 'Nc3', 'Nc6', 'Be2', 'O-O-O']), [
        ['00', '00', 'bK', 'bR', '00', 'bB', 'bN', 'bR'],
        ['bP', 'bP', 'bP', 'bQ', 'bP', 'bP', 'bP', 'bP'],
        ['00', '00', 'bN', '00', '00', '00', '00', '00'],
        ['00', '00', '00', 'bP', '00', 'bB', '00', '00'],
        ['00', '00', '00', 'wP', '00', '00', '00', '00'],
        ['00', '00', 'wN', '00', 'wP', 'wN', '00', '00'],
        ['wP', 'wP', 'wP', '00', 'wB', 'wP', 'wP', 'wP'],
        ['wR', '00', 'wB', 'wQ', 'wK', '00', '00', 'wR'],
    ]);
});